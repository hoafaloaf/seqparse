#!/usr/bin/env python
"""Command line tool for listing file sequences."""

# Standard Libraries
import inspect
import os
import sys
from argparse import ArgumentParser, RawTextHelpFormatter

try:
    from seqparse import get_parser
except:
    ROOT_DIR = os.path.dirname(inspect.getsourcefile(lambda: None))
    ROOT_DIR = os.path.dirname(os.path.abspath(ROOT_DIR))
    sys.path.insert(0, os.path.join(ROOT_DIR, "python"))
    from seqparse import get_parser


def main(search_path=None):
    """Wrap and initialise the seqparse class."""
    if not search_path:
        search_paths = ["."]
    elif isinstance(search_path, (list, set, tuple)):
        search_paths = search_path
    else:
        search_paths = [search_path]

    for search_path in sorted(search_paths):
        search_path = os.path.abspath(search_path)

        seqs = get_parser()
        seqs.scan_path(search_path)

    for output in seqs.output():
        print output


if __name__ == "__main__":
    parser = ArgumentParser(
        description=__doc__, formatter_class=RawTextHelpFormatter)

    parser.add_argument(
        "search_path",
        default=["."],
        help=("Paths that you'd like to search for file sequences."),
        nargs="*")

    # Parse the arguments.
    args = parser.parse_args()

    sys.exit(main(**vars(args)))
